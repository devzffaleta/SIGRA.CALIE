<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Sidebar</title>
    <!-- Font Awesome (necessário para os ícones) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- CSS da Sidebar -->
    <link rel="stylesheet" href="/css/sidebar.css">
    <!-- CSS do Layout (Perfil Topo Direito e Body Padding) -->
    <link rel="stylesheet" href="/css/layout.css">
    <!-- CSS da Página de Edição de Perfil -->
    <link rel="stylesheet" href="/css/profile-edit.css">
    <link rel="stylesheet" href="/css/configuracao.css">
    <link rel="stylesheet" href="/css/gerenciamento-usuarios.css">
    <link rel="stylesheet" href="/css/grupo-permissoes.css">
    <link rel="stylesheet" href="/css/modal.css">
</head>
<body>

    {{! --- Seção do Perfil no Topo Direito (Agora é um link) --- }}
    <a href="/profile/edit" class="top-right-profile-link">
        <div class="top-right-profile">
            <i class="fas fa-bell profile-bell-icon"></i>
            <div class="profile-details">
                <div class="avatar-circle">C</div>
                <div class="user-text">
                    <span class="profile-name">Consultor</span>
                    <span class="profile-role">Consultor</span>
                </div>
            </div>
        </div>
    </a>

    {{! Botão Hambúrguer (visível apenas em mobile via CSS) }}
    <button class="sidebar-toggle-button">
        <i class="fas fa-bars"></i>
    </button>

    {{! Overlay (visível apenas quando sidebar está aberta em mobile) }}
    <div class="overlay"></div>

    {{! Inclui a sidebar }}
    {{> sidebar}}

    <main class="main-page-content">
        {{#if showProfileEdit}}
            {{! Inclui o formulário de edição de perfil }}
            {{> profile-edit-form}}
        {{else if (eq pageType 'configuracao')}}
            {{! Conteúdo da Página de Configuração --}}
            <h1>{{pageTitle}}</h1>

            {{!-- Grid para os cards de configuração --}}
            <div class="config-grid">
                {{!-- Card 1: Gerenciamento de Usuários (link) --}}
                <a href="/gerenciamento-usuarios" class="config-card-link">
                    <div class="config-card card-usuarios">
                        <i class="fas fa-users card-icon"></i>
                        <div class="card-content">
                            <h3>Gerenciamento de Usuários</h3>
                            <p>Crie, edite e gerencie usuários do sistema, definindo funções e vinculando cooperativas.</p>
                        </div>
                    </div>
                </a>

                {{!-- Card 5: Grupo de Permissões (movido para cá) --}}
                <a href="/grupo-permissoes" class="config-card-link">
                    <div class="config-card card-permissoes" style="background-color: #D1FAE5;"> 
                        <i class="fas fa-key card-icon" style="color: #047857;"></i> 
                        <div class="card-content">
                            <h3 style="color: #047857;">Grupo de Permissões</h3>
                            <p style="color: #047857;">Crie, edite e gerencie grupo de permissões para os usuários do sistema.</p>
                        </div>
                    </div>
                 </a>

                {{!-- Card 2: Configuração de SGAs --}}
                <div class="config-card card-sgas">
                    <i class="fas fa-database card-icon"></i> {{!-- Usando fas fa-database como alternativa --}}
                    <div class="card-content">
                        <h3>Configuração de SGAs</h3>
                        <p>Configure as credenciais para integração com a API do SGA, permitindo a importação automática de dados.</p>
                    </div>
                </div>

                {{!-- Card 3: Configurações do Sistema --}}
                <div class="config-card card-sistema">
                     <i class="fas fa-cogs card-icon"></i> {{!-- Usando fas fa-cogs --}}
                    <div class="card-content">
                        <h3>Configurações do Sistema</h3>
                        <p>Ajuste as configurações gerais do sistema, incluindo regras de categorização dos associados.</p>
                    </div>
                </div>

                {{!-- Card 4: Sincronização de Dados --}}
                <div class="config-card card-sync">
                    <i class="fas fa-sync-alt card-icon"></i> {{!-- Usando fas fa-sync-alt --}}
                    <div class="card-content">
                        <h3>Sincronização de Dados</h3>
                        <p>Execute manualmente a sincronização de dados com os SGAs configurados.</p>
                    </div>
                </div>
            </div>

            {{!-- Seção de Informações do Sistema --}}
            <div class="info-sistema-section">
                <h2>Informações do Sistema</h2>
                <dl class="info-sistema-dl">
                    <div>
                        <dt>Versão do Sistema</dt>
                        <dd>1.0.0</dd>
                    </div>
                     <div>
                        <dt>Total de Usuários</dt>
                        <dd>42</dd> {{!-- Exemplo --}}
                    </div>
                     <div>
                        <dt>Última Sincronização</dt>
                        <dd>15/05/2025 às 08:30</dd> {{!-- Exemplo --}}
                    </div>
                     <div>
                        <dt>Total de SGAs Configurados</dt>
                        <dd>3</dd> {{!-- Exemplo --}}
                    </div>
                </dl>
            </div>
        {{else if (eq pageType 'gerenciamentoUsuarios')}}
             {{! Conteúdo da Página de Gerenciamento de Usuários --}}
            <h1>{{pageTitle}}</h1>

            <div class="user-actions">
                <button class="btn btn-primary btn-add-user"> <i class="fas fa-plus"></i> Adicionar Usuário</button>
            </div>

            {{!-- Tabela para Desktop --}}
            <div class="user-table-wrapper desktop-only"> {{!-- Wrapper e classe desktop --}}
                <table class="user-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Função</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each users}}
                            <tr>
                                <td>{{this.nome}}</td>
                                <td>{{this.email}}</td>
                                <td>{{this.funcao}}</td>
                                <td>{{this.status}}</td>
                                <td class="actions">
                                    <button class="btn btn-sm btn-edit" title="Editar"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-sm btn-delete" title="Excluir"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        {{else}}
                            <tr>
                                <td colspan="5" class="no-users-message">Nenhum usuário encontrado.</td>
                            </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>

            {{!-- Cards para Mobile --}}
            <div class="user-cards-mobile mobile-only">
                {{#each users}}
                    <div class="user-card-mobile"> {{!-- Nova classe para card --}}
                        <div class="card-header">
                            <strong>{{this.nome}}</strong>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-edit" title="Editar"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-sm btn-delete" title="Excluir"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        <div class="card-body">
                            <p><strong>Email:</strong> {{this.email}}</p>
                            <p><strong>Função:</strong> {{this.funcao}}</p>
                            <p><strong>Status:</strong> <span class="status-{{toLowerCase this.status}}">{{this.status}}</span></p> {{!-- Classe para cor status --}}
                        </div>
                    </div>
                {{else}}
                    <p class="no-users-message">Nenhum usuário encontrado.</p>
                {{/each}}
            </div>

            {{!-- ********** NOVO: Modal Adicionar Usuário ********** --}}
            <div id="add-user-modal" class="modal-overlay hidden"> 
                <div class="modal-content large"> {{!-- Adicionei a classe 'large' para modais maiores --}}
                    <div class="modal-header">
                        <h2>Novo Usuário</h2> 
                        <button id="close-add-user-modal-btn" class="modal-close-btn">&times;</button> 
                    </div>
                    <div class="modal-body">
                        <form id="add-user-form"> 
                            {{!-- Linha 1: Nome Completo, Usuário --}}
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="add-user-nome">Nome Completo <span class="required">*</span></label>
                                    <input type="text" id="add-user-nome" name="add-user-nome" required>
                                </div>
                                <div class="form-group">
                                    <label for="add-user-usuario">Usuário <span class="required">*</span></label>
                                    <input type="text" id="add-user-usuario" name="add-user-usuario" required>
                                </div>
                            </div>

                            {{!-- Linha 2: Senha, Cooperativa --}}
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="add-user-senha">Senha <span class="required">*</span></label>
                                    <input type="password" id="add-user-senha" name="add-user-senha" required>
                                </div>
                                <div class="form-group">
                                    <label for="add-user-cooperativa">Cooperativa Vinculada <span class="required">*</span></label>
                                    <select id="add-user-cooperativa" name="add-user-cooperativa" required>
                                        <option value="" disabled selected>Selecione a cooperativa...</option>
                                        {{!-- Opções virão do backend --}}
                                        <option value="coop1">Cooperativa Alfa</option>
                                        <option value="coop2">Cooperativa Beta</option>
                                    </select>
                                    <small>Selecione a cooperativa à qual o usuário será vinculado</small>
                                </div>
                            </div>
                            
                            {{!-- Linha 3: SGA, Código Voluntário --}}
                             <div class="form-row">
                                <div class="form-group">
                                    <label for="add-user-sga">SGA de Origem <span class="required">*</span></label>
                                    <select id="add-user-sga" name="add-user-sga" required>
                                        <option value="" disabled selected>Selecione o SGA...</option>
                                         {{!-- Opções virão do backend --}}
                                        <option value="sga1">SGA Principal</option>
                                        <option value="sga2">SGA Secundário</option>
                                    </select>
                                     <small>Selecione o SGA de onde os dados do usuário serão buscados</small>
                                </div>
                                <div class="form-group">
                                    <label for="add-user-cod-voluntario">Código do Voluntário</label>
                                    <input type="text" id="add-user-cod-voluntario" name="add-user-cod-voluntario" placeholder="Ex: VOL001">
                                    <small>Código do voluntário correspondente na base do SGA para integração</small>
                                </div>
                            </div>

                            {{!-- Linha 4: Função, Comissão Visível --}}
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="add-user-funcao">Função <span class="required">*</span></label>
                                    <select id="add-user-funcao" name="add-user-funcao" required>
                                        <option value="" disabled selected>Selecione a função...</option>
                                        {{!-- Opções virão do backend/grupos de permissão --}}
                                        <option value="admin">Administrador</option>
                                        <option value="consultor">Consultor Vendas</option>
                                        <option value="financeiro">Financeiro</option>
                                        <option value="lider">Líder</option> {{!-- Adicionei líder --}}
                                    </select>
                                </div>
                                <div class="form-group input-percent">
                                    <label for="add-user-comissao-visivel">Porcentagem de Comissão Direta * (visível)</label>
                                    <input type="number" id="add-user-comissao-visivel" name="add-user-comissao-visivel" min="0" max="100" step="0.01">
                                    <span>%</span>
                                    <small>Esta porcentagem será exibida na tela de recorrentes para consultores e coordenadores</small>
                                </div>
                            </div>

                             {{!-- Linha 5: Comissão Invisível, Retirada Geral --}}
                            <div class="form-row">
                                <div class="form-group input-percent">
                                    <label for="add-user-comissao-invisivel">Porcentagem de Comissão Direta * <span class="tooltip-trigger" title="Esta porcentagem será utilizada para calcular o valor do recorrente, mas não será exibida na interface">(invisível) <i class="fas fa-info-circle"></i></span></label>
                                    <input type="number" id="add-user-comissao-invisivel" name="add-user-comissao-invisivel" min="0" max="100" step="0.01">
                                    <span>%</span>
                                </div>
                                <div class="form-group input-percent">
                                    <label for="add-user-retirada">Porcentagem de Retirada * <span class="tooltip-trigger" title="Esta porcentagem será deduzida do valor total pago pelo associado e será exibida apenas para líderes na tela de gestão financeira">(visível apenas para líderes) <i class="fas fa-info-circle"></i></span></label>
                                    <input type="number" id="add-user-retirada" name="add-user-retirada" min="0" max="100" step="0.01">
                                     <span>%</span>
                                </div>
                            </div>

                            {{!-- Linha 6: Coordenadores Responsáveis --}}
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="add-user-coord1">Coordenadores Responsáveis</label>
                                    <select id="add-user-coord1" name="add-user-coord1">
                                        <option value="" selected>Selecione o 1º coordenador...</option>
                                        {{!-- Opções virão do backend (usuários líderes/coord) --}}
                                        <option value="coordA">Coordenador A</option>
                                        <option value="coordB">Coordenador B</option>
                                    </select>
                                </div>
                                 <div class="form-group">
                                     <label for="add-user-coord2" style="visibility: hidden;">Coordenador 2</label> {{!-- Label oculto para alinhar --}}
                                     <select id="add-user-coord2" name="add-user-coord2">
                                        <option value="" selected>Selecione o 2º coordenador...</option>
                                        {{!-- Opções virão do backend --}}
                                         <option value="coordA">Coordenador A</option>
                                        <option value="coordB">Coordenador B</option>
                                    </select>
                                     <small>Selecione até 2 coordenadores responsáveis</small>
                                </div>
                            </div>

                            {{!-- Linha 7: Comissão Coordenadores --}}
                             <div class="form-row">
                                <div class="form-group input-percent">
                                    <label for="add-user-comissao-coords">Porcentagem de Comissão dos Coordenadores</label>
                                    <input type="number" id="add-user-comissao-coords" name="add-user-comissao-coords" min="0" max="100" step="0.01">
                                    <span>%</span>
                                    <small>Esta porcentagem será dividida igualmente entre os coordenadores selecionados</small>
                                </div>
                                <div class="form-group"></div> {{!-- Placeholder para alinhar --}}
                            </div>

                            <div class="modal-footer">
                                <button type="button" id="cancel-add-user-btn" class="btn btn-secondary">Cancelar</button> {{!-- Tipo button pra não submeter --}}
                                <button type="submit" class="btn btn-primary">Criar</button> 
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            {{!-- Fim do Modal Adicionar Usuário --}}

            {{!-- ********** NOVO: Modal Editar Usuário ********** --}}
            <div id="edit-user-modal" class="modal-overlay hidden"> 
                <div class="modal-content large"> 
                    <div class="modal-header">
                        <h2>Editar Usuário</h2> 
                        <button id="close-edit-user-modal-btn" class="modal-close-btn">&times;</button> 
                    </div>
                    <div class="modal-body">
                        <form id="edit-user-form"> 
                            <input type="hidden" id="edit-user-id" name="edit-user-id"> {{!-- Campo oculto para ID --}}
                            
                             {{!-- Linha 1: Nome Completo, Usuário --}}
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="edit-user-nome">Nome Completo <span class="required">*</span></label>
                                    <input type="text" id="edit-user-nome" name="edit-user-nome" required>
                                </div>
                                <div class="form-group">
                                    <label for="edit-user-usuario">Usuário <span class="required">*</span></label>
                                    <input type="text" id="edit-user-usuario" name="edit-user-usuario" required>
                                </div>
                            </div>

                            {{!-- Linha 2: Cooperativa, SGA --}}
                             <div class="form-row">
                                <div class="form-group">
                                    <label for="edit-user-cooperativa">Cooperativa Vinculada <span class="required">*</span></label>
                                    <select id="edit-user-cooperativa" name="edit-user-cooperativa" required>
                                        <option value="" disabled>Selecione a cooperativa...</option>
                                        {{!-- Opções virão do backend --}}
                                        <option value="coop1">Cooperativa Alfa</option>
                                        <option value="coop2">Cooperativa Beta</option>
                                    </select>
                                    <small>Selecione a cooperativa à qual o usuário será vinculado</small>
                                </div>
                                <div class="form-group">
                                    <label for="edit-user-sga">SGA de Origem <span class="required">*</span></label>
                                    <select id="edit-user-sga" name="edit-user-sga" required>
                                        <option value="" disabled>Selecione o SGA...</option>
                                         {{!-- Opções virão do backend --}}
                                        <option value="sga1">SGA Principal</option>
                                        <option value="sga2">SGA Secundário</option>
                                    </select>
                                     <small>Selecione o SGA de onde os dados do usuário serão buscados</small>
                                </div>
                            </div>
                            
                            {{!-- Linha 3: Código Voluntário, Função --}}
                             <div class="form-row">
                                <div class="form-group">
                                    <label for="edit-user-cod-voluntario">Código do Voluntário</label>
                                    <input type="text" id="edit-user-cod-voluntario" name="edit-user-cod-voluntario" placeholder="Ex: VOL001">
                                    <small>Código do voluntário correspondente na base do SGA para integração</small>
                                </div>
                                 <div class="form-group">
                                    <label for="edit-user-funcao">Função <span class="required">*</span></label>
                                    <select id="edit-user-funcao" name="edit-user-funcao" required>
                                        <option value="" disabled>Selecione a função...</option>
                                        {{!-- Opções virão do backend/grupos de permissão --}}
                                        <option value="admin">Administrador</option>
                                        <option value="consultor">Consultor Vendas</option>
                                        <option value="financeiro">Financeiro</option>
                                        <option value="lider">Líder</option>
                                    </select>
                                </div>
                            </div>

                            {{!-- Linha 4: Comissão Visível, Comissão Invisível --}}
                            <div class="form-row">
                                <div class="form-group input-percent">
                                    <label for="edit-user-comissao-visivel">Porcentagem de Comissão Direta * (visível)</label>
                                    <input type="number" id="edit-user-comissao-visivel" name="edit-user-comissao-visivel" min="0" max="100" step="0.01">
                                    <span>%</span>
                                    <small>Esta porcentagem será exibida na tela de recorrentes para consultores e coordenadores</small>
                                </div>
                                <div class="form-group input-percent">
                                    <label for="edit-user-comissao-invisivel">Porcentagem de Comissão Direta * <span class="tooltip-trigger" title="Esta porcentagem será utilizada para calcular o valor do recorrente, mas não será exibida na interface">(invisível) <i class="fas fa-info-circle"></i></span></label>
                                    <input type="number" id="edit-user-comissao-invisivel" name="edit-user-comissao-invisivel" min="0" max="100" step="0.01">
                                    <span>%</span>
                                </div>
                            </div>

                             {{!-- Linha 5: Retirada Geral, Comissão Coords --}}
                            <div class="form-row">
                                <div class="form-group input-percent">
                                    <label for="edit-user-retirada">Porcentagem de Retirada * <span class="tooltip-trigger" title="Esta porcentagem será deduzida do valor total pago pelo associado e será exibida apenas para líderes na tela de gestão financeira">(visível apenas para líderes) <i class="fas fa-info-circle"></i></span></label>
                                    <input type="number" id="edit-user-retirada" name="edit-user-retirada" min="0" max="100" step="0.01">
                                     <span>%</span>
                                </div>
                                 <div class="form-group input-percent">
                                    <label for="edit-user-comissao-coords">Porcentagem de Comissão dos Coordenadores</label>
                                    <input type="number" id="edit-user-comissao-coords" name="edit-user-comissao-coords" min="0" max="100" step="0.01">
                                    <span>%</span>
                                    <small>Esta porcentagem será dividida igualmente entre os coordenadores selecionados</small>
                                </div>
                            </div>

                            {{!-- Linha 6: Coordenadores Responsáveis --}}
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="edit-user-coord1">Coordenadores Responsáveis</label>
                                    <select id="edit-user-coord1" name="edit-user-coord1">
                                        <option value="">Selecione o 1º coordenador...</option>
                                        {{!-- Opções virão do backend (usuários líderes/coord) --}}
                                        <option value="coordA">Coordenador A</option>
                                        <option value="coordB">Coordenador B</option>
                                    </select>
                                </div>
                                 <div class="form-group">
                                     <label for="edit-user-coord2" style="visibility: hidden;">Coordenador 2</label> {{!-- Label oculto para alinhar --}}
                                     <select id="edit-user-coord2" name="edit-user-coord2">
                                        <option value="">Selecione o 2º coordenador...</option>
                                        {{!-- Opções virão do backend --}}
                                         <option value="coordA">Coordenador A</option>
                                        <option value="coordB">Coordenador B</option>
                                    </select>
                                     <small>Selecione até 2 coordenadores responsáveis</small>
                                </div>
                            </div>
                            
                            <div class="modal-footer">
                                <button type="button" id="cancel-edit-user-btn" class="btn btn-secondary">Cancelar</button> 
                                <button type="submit" class="btn btn-primary">Salvar Alterações</button> 
                            </div>
                        </form>
                    </div>
                </div>
            </div>
             {{!-- Fim do Modal Editar Usuário --}}

        {{else if (eq pageType 'grupoPermissoes')}}
            {{! Conteúdo da Página de Grupo de Permissões --}}
            <h1>{{pageTitle}}</h1>

            <div class="user-actions"> 
                <button id="add-group-btn" class="btn btn-primary"> <i class="fas fa-plus"></i> Adicionar Grupo</button> 
            </div>

            {{!-- Tabela para Desktop --}}
            <div class="table-responsive-wrapper desktop-only"> {{!-- Classe para esconder em mobile --}}
                <table class="permission-group-table"> 
                    <thead>
                        <tr>
                            <th>Nome do Grupo</th>
                            <th>Descrição</th>
                            <th>Nº de Usuários</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each grupos}}
                            <tr>
                                <td>{{this.nome}}</td>
                                <td>{{this.descricao}}</td>
                                <td>{{this.numUsuarios}}</td> 
                                <td class="actions">
                                    <button class="btn btn-sm btn-edit" title="Editar"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-sm btn-delete" title="Excluir"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        {{else}}
                            <tr>
                                <td colspan="4" class="no-groups-message">Nenhum grupo de permissão encontrado.</td>
                            </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>

             {{!-- Cards para Mobile --}}
            <div class="permission-group-cards-mobile mobile-only"> {{!-- Classe para esconder em desktop --}}
                {{#each grupos}}
                    <div class="permission-group-card-mobile">
                        <div class="card-header">
                            <strong>{{this.nome}}</strong>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-edit" title="Editar"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-sm btn-delete" title="Excluir"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        <div class="card-body">
                            <p><strong>Descrição:</strong> {{this.descricao}}</p>
                            <p><strong>Nº de Usuários:</strong> {{this.numUsuarios}}</p>
                        </div>
                    </div>
                {{else}}
                    <p class="no-groups-message">Nenhum grupo de permissão encontrado.</p>
                {{/each}}
            </div>

            {{!-- Fim do Modal Adicionar --}}

            {{!-- Modal para Editar Grupo de Permissão (Novo) --}}
            <div id="edit-group-modal" class="modal-overlay hidden"> {{!-- ID diferente, escondido --}}
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Editar grupo de permissão</h2> {{!-- Título diferente --}}
                        <button id="close-edit-modal-btn" class="modal-close-btn">&times;</button> {{!-- ID diferente --}}
                    </div>
                    <div class="modal-body">
                        {{!-- O action do form pode ser diferente no futuro --}}
                        <form id="edit-group-form"> {{!-- ID diferente --}}
                            <input type="hidden" id="edit-group-id" name="edit-group-id"> {{!-- Campo oculto para ID do grupo --}}
                            <div class="form-group">
                                <label for="edit-group-name">Nome do Grupo <span class="required">*</span></label>
                                <input type="text" id="edit-group-name" name="edit-group-name" required> {{!-- ID diferente --}}
                            </div>

                            <fieldset class="permission-section">
                                <legend>Permissões <span class="required">*</span></legend>
                                {{!-- As permissões terão IDs diferentes para evitar conflito --}}
                                {{!-- Exemplo: id="edit-perm-menu-vistoria" --}}

                                <div class="permission-category">
                                    <h3>Acesso a menus</h3>
                                    <div class="permission-grid">
                                        {{!-- Atenção: Os IDs e fors dos checkboxes/labels DEVEM ser únicos para o modal de edição --}}
                                        <div class="permission-item"><input type="checkbox" id="edit-perm-menu-vistoria"><label for="edit-perm-menu-vistoria">Aprovar Vistorias</label><i class="fas fa-question-circle tooltip-icon"></i></div>
                                        <div class="permission-item"><input type="checkbox" id="edit-perm-menu-painel"><label for="edit-perm-menu-painel">Acessar Painel Financeiro</label><i class="fas fa-question-circle tooltip-icon"></i></div>
                                        <div class="permission-item"><input type="checkbox" id="edit-perm-menu-relatorio"><label for="edit-perm-menu-relatorio">Acessar Relatórios</label><i class="fas fa-question-circle tooltip-icon"></i></div>
                                        <div class="permission-item"><input type="checkbox" id="edit-perm-menu-contato"><label for="edit-perm-menu-contato">Acessar Contatos</label><i class="fas fa-question-circle tooltip-icon"></i></div>
                                        <div class="permission-item"><input type="checkbox" id="edit-perm-menu-config"><label for="edit-perm-menu-config">Acessar Configurações da Empresa</label><i class="fas fa-question-circle tooltip-icon"></i></div>
                                        <div class="permission-item"><input type="checkbox" id="edit-perm-menu-ferramenta"><label for="edit-perm-menu-ferramenta">Acessar Ferramentas</label><i class="fas fa-question-circle tooltip-icon"></i></div>
                                    </div>
                                </div>
                                 {{!-- Repetir estrutura similar para as outras categorias de permissão, --}}
                                 {{!-- SEMPRE usando IDs únicos (ex: prefixo 'edit-') --}}
                                 {{!-- ... (categorias cotações, vistorias, relatórios com IDs únicos) ... --}}

                            </fieldset>

                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary">Salvar Alterações</button> {{!-- Texto diferente --}}
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            {{!-- Fim do Modal Editar --}}

        {{else}}
            {{! Conteúdo da página de teste padrão }}
            <h1>Página de Teste da Sidebar</h1>
            <p>Este é o conteúdo principal da página.</p>
            <p>A sidebar deve estar fixa à esquerda.</p>
            <p>Redimensione a tela para testar a responsividade.</p>
        {{/if}}
    </main>

    {{! Script para funcionalidade dos menus }}
    <script>
        // --- Menu Mobile (Hambúrguer) ---
        const sidebarToggleButton = document.querySelector('.sidebar-toggle-button');
        const sidebar = document.querySelector('.sidebar'); // Usado por ambos
        const overlay = document.querySelector('.overlay');

        if (sidebarToggleButton && sidebar && overlay) {
            sidebarToggleButton.addEventListener('click', () => {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
                sidebarToggleButton.classList.toggle('hidden-by-js');
            });

            overlay.addEventListener('click', () => {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
                sidebarToggleButton.classList.remove('hidden-by-js'); 
            });
        }

        // --- Menu Desktop (Encolher/Expandir) ---
        const desktopToggleButton = document.querySelector('.desktop-sidebar-toggle');
        const bodyElement = document.body;

        if (desktopToggleButton && sidebar && bodyElement) {
            desktopToggleButton.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
                bodyElement.classList.toggle('body-sidebar-collapsed'); // Classe para ajustar padding do body
            });
        }

    </script>

    {{!-- Novo Script para o Modal --}}
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // --- Controle do Modal "Adicionar Grupo" ---
        const addGroupBtn = document.getElementById('add-group-btn');
        const addGroupModal = document.getElementById('add-group-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        // const cancelModalBtn = document.getElementById('cancel-modal-btn');

        // Função para abrir modal
        const openModal = () => {
            if (addGroupModal) {
                console.log("Abrindo modal..."); // Log de depuração
                addGroupModal.classList.remove('hidden');
            } else {
                console.error("Elemento do modal não encontrado!");
            }
        };

        // Função para fechar modal
        const closeModal = () => {
             if (addGroupModal) {
                console.log("Fechando modal..."); // Log de depuração
                addGroupModal.classList.add('hidden');
            } else {
                 console.error("Elemento do modal não encontrado ao fechar!");
            }
        };

        // Event Listeners
        if (addGroupBtn) {
            addGroupBtn.addEventListener('click', openModal);
            console.log("Listener adicionado ao botão Adicionar Grupo."); // Log de depuração
        } else {
             console.error("Botão Adicionar Grupo não encontrado!");
        }

        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', closeModal);
        } else {
             console.error("Botão Fechar Modal não encontrado!");
        }
        
        // Fechar se clicar fora do modal (no overlay)
        if (addGroupModal) {
            addGroupModal.addEventListener('click', (event) => {
                if (event.target === addGroupModal) {
                    closeModal();
                }
            });
        } else {
            console.error("Elemento do modal não encontrado para listener de overlay!");
        }

        // Prevenir envio do formulário (apenas exemplo)
        const addGroupForm = document.getElementById('add-group-form');
        if (addGroupForm) {
            addGroupForm.addEventListener('submit', (event) => {
                event.preventDefault(); 
                alert('Formulário enviado (simulação)! Fechando modal.');
                closeModal();
            });
        } else {
            console.error("Formulário do modal não encontrado!");
        }
      });
    </script>

    {{!-- ********** NOVO: Script para Modais de Usuário ********** --}}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Seletores Comuns ---
            const addUserModal = document.getElementById('add-user-modal');
            const editUserModal = document.getElementById('edit-user-modal');

            // --- Controle do Modal "Adicionar Usuário" ---
            const addUserBtn = document.querySelector('.btn-add-user'); 
            const closeAddUserBtn = document.getElementById('close-add-user-modal-btn');
            const cancelAddUserBtn = document.getElementById('cancel-add-user-btn');
            const addUserForm = document.getElementById('add-user-form');

            const openAddUserModal = () => addUserModal?.classList.remove('hidden');
            const closeAddUserModal = () => addUserModal?.classList.add('hidden');

            if (addUserBtn) {
                addUserBtn.addEventListener('click', openAddUserModal);
            } else {
                console.error('Botão "Adicionar Usuário" não encontrado.');
            }

            if (closeAddUserBtn) {
                closeAddUserBtn.addEventListener('click', closeAddUserModal);
            }
            if (cancelAddUserBtn) {
                cancelAddUserBtn.addEventListener('click', closeAddUserModal);
            }
            if (addUserModal) {
                addUserModal.addEventListener('click', (event) => {
                    if (event.target === addUserModal) closeAddUserModal();
                });
            }
             if (addUserForm) {
                addUserForm.addEventListener('submit', (event) => {
                    event.preventDefault();
                    alert('Formulário Adicionar Usuário enviado (simulação)! Fechando modal.');
                    closeAddUserModal();
                    // Lógica real de envio fetch/AJAX aqui
                });
            }

            // --- Controle do Modal "Editar Usuário" ---
            const editUserBtns = document.querySelectorAll('.user-table .btn-edit, .user-cards-mobile .btn-edit'); // Pega botões da tabela E dos cards
            const closeEditUserBtn = document.getElementById('close-edit-user-modal-btn');
            const cancelEditUserBtn = document.getElementById('cancel-edit-user-btn');
            const editUserForm = document.getElementById('edit-user-form');
            const editUserIdInput = document.getElementById('edit-user-id'); // Campo oculto ID
            // Outros campos do form de edição para preencher...
            const editUserNameInput = document.getElementById('edit-user-nome');
            const editUserUsuarioInput = document.getElementById('edit-user-usuario');
            const editUserCooperativaSelect = document.getElementById('edit-user-cooperativa');
            const editUserSgaSelect = document.getElementById('edit-user-sga');
            const editUserCodVoluntarioInput = document.getElementById('edit-user-cod-voluntario');
            const editUserFuncaoSelect = document.getElementById('edit-user-funcao');
            // ... (seletores para os campos de porcentagem e coordenadores) ...

            const openEditUserModal = (userData) => {
                if (!editUserModal || !editUserIdInput || !editUserNameInput /* etc... */) {
                    console.error('Elementos do modal de edição não encontrados!');
                    return;
                }
                console.log('Abrindo modal para editar usuário:', userData);
                
                // Preencher o formulário (exemplo básico - precisa dos dados reais)
                editUserIdInput.value = userData.id || ''; // Assumindo que teremos um ID
                editUserNameInput.value = userData.nome || '';
                editUserUsuarioInput.value = userData.usuario || ''; // Campo usuário?
                editUserCooperativaSelect.value = userData.cooperativa || ''; // Precisa do value correto
                editUserSgaSelect.value = userData.sga || ''; // Precisa do value correto
                editUserCodVoluntarioInput.value = userData.codVoluntario || '';
                editUserFuncaoSelect.value = userData.funcaoValue || ''; // Precisa do value da função
                // Preencher os outros campos (comissão, retirada, etc.)

                editUserModal.classList.remove('hidden');
            };
            const closeEditUserModal = () => editUserModal?.classList.add('hidden');

            if (editUserBtns.length > 0) {
                editUserBtns.forEach(button => {
                    button.addEventListener('click', (event) => {
                        // --- Lógica para buscar dados do usuário (PLACEHOLDER) ---
                        // Idealmente, buscaria os dados via API ou do elemento pai
                        const placeholderData = {
                            id: 'user123',
                            nome: 'Nome do Usuário a Editar',
                            usuario: 'usuario.editar',
                            cooperativa: 'coop1', // Value da option
                            sga: 'sga2', // Value da option
                            codVoluntario: 'VOL-EDIT',
                            funcaoValue: 'consultor' // Value da option
                            // ... outros dados ...
                        };
                        // ----------------------------------------------------------
                        openEditUserModal(placeholderData);
                    });
                });
            } else {
                console.warn('Nenhum botão "Editar Usuário" encontrado.');
            }

            if (closeEditUserBtn) {
                closeEditUserBtn.addEventListener('click', closeEditUserModal);
            }
             if (cancelEditUserBtn) {
                cancelEditUserBtn.addEventListener('click', closeEditUserModal);
            }
            if (editUserModal) {
                editUserModal.addEventListener('click', (event) => {
                    if (event.target === editUserModal) closeEditUserModal();
                });
            }
             if (editUserForm) {
                editUserForm.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const userId = editUserIdInput.value;
                    alert(`Formulário Editar Usuário enviado (simulação) para ID: ${userId}! Fechando modal.`);
                    closeEditUserModal();
                    // Lógica real de envio fetch/AJAX aqui
                });
            }

        });
    </script>

</body>
</html> 